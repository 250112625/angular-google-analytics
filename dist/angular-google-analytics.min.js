/**
 * Angular Google Analytics - Easy tracking for your AngularJS application
 * @version v0.0.7 - 2014-10-20
 * @link http://github.com/revolunet/angular-google-analytics
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-google-analytics",[]).provider("Analytics",function(){var a,b,c,d,e,f,g=!1,h=!0,i="",j=!1,k="$routeChangeSuccess",l="auto",m=!1,n=!1,o=!1,p=!1,q=!1,r={allowLinker:!0};this._logs=[],this.setAccount=function(b){return a=b,!0},this.trackPages=function(a){return h=a,!0},this.trackPrefix=function(a){return i=a,!0},this.setDomainName=function(a){return c=a,!0},this.useDisplayFeatures=function(a){return b=!!a,!0},this.useAnalytics=function(a){return j=!!a,!0},this.useEnhancedLinkAttribution=function(a){return o=!!a,!0},this.useCrossDomainLinker=function(a){return q=!!a,!0},this.setCrossLinkDomains=function(a){return f=a,!0},this.setPageEvent=function(a){return k=a,!0},this.setCookieConfig=function(a){return l=a,!0},this.useECommerce=function(a,b){return m=!!a,n=!!b,!0},this.setRemoveRegExp=function(a){return a instanceof RegExp?(d=a,!0):!1},this.setExperimentId=function(a){return e=a,!0},this.ignoreFirstPageLoad=function(a){p=!!a},this.$get=["$document","$rootScope","$location","$window",function(s,t,u,v){function w(){if(a){v._gaq=[],v._gaq.push(["_setAccount",a]),c&&v._gaq.push(["_setDomainName",c]),o&&v._gaq.push(["_require","inpage_linkid","//www.google-analytics.com/plugins/ga/inpage_linkid.js"]),h&&!p&&v._gaq.push(d?["_trackPageview",y()]:["_trackPageview"]);var e;e=b?("https:"===document.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js":("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",function(){var a=s[0],b=a.createElement("script");b.type="text/javascript",b.async=!0,b.src=e;var c=a.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}(e),g=!0}}function x(){if(!a)return console.warn("No account id set for Analytics.js");if(function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),angular.isArray(a)?a.forEach(function(a){v.ga("create",a.tracker,l,{name:a.name})}):q?(v.ga("create",a,l,r),v.ga("require","linker"),f&&v.ga("linker:autoLink",f)):v.ga("create",a,l),b&&v.ga("require","displayfeatures"),h&&!p&&v.ga("send","pageview",y()),v.ga&&(m&&(n?v.ga("require","ec","ec.js"):v.ga("require","ecommerce","ecommerce.js")),o&&v.ga("require","linkid","linkid.js"),e)){var c=document.createElement("script"),d=document.getElementsByTagName("script")[0];c.src="//www.google-analytics.com/cx/api.js?experiment="+e,d.parentNode.insertBefore(c,d)}}var y=function(){var a=u.path();return d?a.replace(d,""):a};this._log=function(){this._logs.push(arguments)},this._trackPage=function(b,c){c=c?c:s[0].title,h&&!j&&v._gaq?(v._gaq.push(["_set","title",c]),v._gaq.push(["_trackPageview",i+b]),this._log("_trackPageview",arguments)):h&&j&&v.ga&&(angular.isArray(a)?a.forEach(function(a){v.ga(a.name+".send","pageview",{page:i+b,title:c})}):v.ga("send","pageview",{page:i+b,title:c}),this._log("pageview",arguments))},this._trackEvent=function(a,b,c,d){!j&&v._gaq?(v._gaq.push(["_trackEvent",a,b,c,d]),this._log("trackEvent",arguments)):v.ga&&(v.ga("send","event",a,b,c,d),this._log("event",arguments))},this._addTrans=function(a,b,c,d,e,f,g,h,i){!j&&v._gaq?(v._gaq.push(["_addTrans",a,b,c,d,e,f,g,h]),this._log("_addTrans",arguments)):v.ga&&(m?n?console.warn("Enhanced ecommerce plugin is enabled. Only one plugin(ecommerce/ec) can be used at a time. Use AnalyticsProvider.setECommerce(true,false);"):(v.ga("ecommerce:addTransaction",{id:a,affiliation:b,revenue:c,tax:d,shipping:e,currency:i||"USD"}),this._log("ecommerce:addTransaction",arguments)):console.warn("ecommerce no set. Use AnalyticsProvider.setECommerce(true,false);"))},this._addItem=function(a,b,c,d,e,f){!j&&v._gaq?(v._gaq.push(["_addItem",a,b,c,d,e,f]),this._log("_addItem",arguments)):v.ga&&(m?n?console.warn("Enhanced ecommerce plugin is enabled. Only one plugin(ecommerce/ec) can be used at a time. Use AnalyticsProvider.setECommerce(true,false);"):(v.ga("ecommerce:addItem",{id:a,name:c,sku:b,category:d,price:e,quantity:f}),this._log("ecommerce:addItem",arguments)):console.warn("ecommerce no set. Use AnalyticsProvider.setECommerce(true,false);"))},this._trackTrans=function(){!j&&v._gaq?(v._gaq.push(["_trackTrans"]),this._log("_trackTrans",arguments)):v.ga&&(m?n?console.warn("Enhanced ecommerce plugin is enabled. Only one plugin(ecommerce/ec) can be used at a time. Use AnalyticsProvider.setECommerce(true,false);"):(v.ga("ecommerce:send"),this._log("ecommerce:send",arguments)):console.warn("ecommerce no set. Use AnalyticsProvider.setECommerce(true,false);"))},this._clearTrans=function(){v.ga&&(m?n?console.warn("Enhanced ecommerce plugin is enabled. Only one plugin(ecommerce/ec) can be used at a time. Use AnalyticsProvider.setECommerce(true,false);"):(v.ga("ecommerce:clear"),this._log("ecommerce:clear",arguments)):console.warn("ecommerce no set. Use AnalyticsProvider.setECommerce(true,false);"))},this._addProduct=function(a,b,c,d,e,f,g,h,i){!j&&v._gaq?(v._gaq.push(["_addProduct",a,b,c,d,e,f,g,h,i]),this._log("_addProduct",arguments)):v.ga&&(m?n?(v.ga("ec:addProduct",{id:a,name:b,category:c,brand:d,variant:e,price:f,quantity:g,coupon:h,position:i}),this._log("ec:addProduct",arguments)):console.warn("Enhanced ecommerce plugin is disabled. Use AnalyticsProvider.setECommerce(true,true);"):console.warn("ecommerce not set. Use AnalyticsProvider.setECommerce(true,true);"))},this._addImpression=function(a,b,c,d,e,f,g,h){!j&&v._gaq?(v._gaq.push(["_addImpression",a,b,c,d,e,f,g,h]),this._log("_addImpression",arguments)):v.ga&&(m?n?v.ga("ec:addImpression",{id:a,name:b,category:e,brand:d,variant:f,list:c,position:g,price:h}):console.warn("Enhanced ecommerce plugin is disabled. Use AnalyticsProvider.setECommerce(true,true);"):console.warn("ecommerce not set. Use AnalyticsProvider.setECommerce(true,true);"),this._log("ec:addImpression",arguments))},this._addPromo=function(a,b,c,d){!j&&v._gaq?(v._gaq.push(["_addPromo",a,b,c,d]),this._log("_addPromo",arguments)):v.ga&&(m?n?(v.ga("ec:addPromo",{id:a,name:b,creative:c,position:d}),this._log("ec:addPromo",arguments)):console.warn("Enhanced ecommerce plugin is disabled. Use AnalyticsProvider.setECommerce(true,true);"):console.warn("ecommerce not set. Use AnalyticsProvider.setECommerce(true,true);"))},this._getActionFieldObject=function(a,b,c,d,e,f,g,h,i){var j={};return a&&(j.id=a),b&&(j.affiliation=b),c&&(j.revenue=c),d&&(j.tax=d),e&&(j.shipping=e),f&&(j.coupon=f),g&&(j.list=g),h&&(j.step=h),i&&(j.option=i),j},this._setAction=function(a,b){!j&&v._gaq?(v._gaq.push(["_setAction",a,b]),this._log("__setAction",arguments)):v.ga&&(m?n?(v.ga("ec:setAction",a,b),this._log("ec:setAction",arguments)):console.warn("Enhanced ecommerce plugin is disabled. Use AnalyticsProvider.setECommerce(true,true);"):console.warn("ecommerce not set. Use AnalyticsProvider.setECommerce(true,true);"))},this._trackTransaction=function(a,b,c,d,e,f,g,h,i){this._setAction("purchase",this._getActionFieldObject(a,b,c,d,e,f,g,h,i)),this._pageView()},this._trackRefund=function(a){this._setAction("refund",this._getActionFieldObject(a)),this._pageView()},this._trackCheckOut=function(a,b){this._setAction("checkout",this._getActionFieldObject(null,null,null,null,null,null,null,a,b)),this._pageView()},this._trackCart=function(a){-1!==["add","remove"].indexOf(a)&&(this._setAction(a),this._send("event","UX","click",a+"to cart"))},this._promoClick=function(a){this._setAction("promo_click"),this._send("event","Internal Promotions","click",a)},this._productClick=function(a){this._setAction("click",this._getActionFieldObject(null,null,null,null,null,null,a,null,null)),this._send("event","UX","click",a)},this._send=function(a){v.ga&&(v.ga("send",a),this._log("send",a))},this._pageView=function(){this._send("pageview")},this._set=function(a,b){v.ga&&(v.ga("set",a,b),this._log("set",a,b))},j?x():w();var z=this;return h&&t.$on(k,function(){z._trackPage(y())}),{_logs:z._logs,cookieConfig:l,displayFeatures:b,ecommerce:m,enhancedEcommerce:n,enhancedLinkAttribution:o,getUrl:y,experimentId:e,ignoreFirstPageLoad:p,trackPage:function(a,b){z._trackPage(a,b)},trackEvent:function(a,b,c,d){z._trackEvent(a,b,c,d)},addTrans:function(a,b,c,d,e,f,g,h,i){z._addTrans(a,b,c,d,e,f,g,h,i)},addItem:function(a,b,c,d,e,f){z._addItem(a,b,c,d,e,f)},trackTrans:function(){z._trackTrans()},clearTrans:function(){z._clearTrans()},addProduct:function(a,b,c,d,e,f,g,h,i){z._addProduct(a,b,c,d,e,f,g,h,i)},addPromo:function(a,b,c,d){z._addPromo(a,b,c,d)},addImpression:function(a,b,c,d,e,f,g,h){z._addImpression(a,b,c,d,e,f,g,h)},productClick:function(a){z._productClick(a)},promoClick:function(a){z._promoClick(a)},trackDetail:function(){z._setAction("detail"),z._pageView()},trackCart:function(a){z._trackCart(a)},trackCheckout:function(a,b){z._trackCheckOut(a,b)},trackTransaction:function(a,b,c,d,e,f,g,h,i){z._trackTransaction(a,b,c,d,e,f,g,h,i)},setAction:function(a,b){z._setAction(a,b)},send:function(a){z._send(a)},pageView:function(){z._pageView()},set:function(a,b){z._set(a,b)}}}]});