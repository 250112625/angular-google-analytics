"use strict";angular.module("angular-google-analytics",[]).provider("Analytics",function(){var e=false,t=true,n,r="",i,s=false,o="$routeChangeSuccess",u="auto",a=false,f=false,l,c,h=false;this._logs=[];this.setAccount=function(e){n=e;return true};this.trackPages=function(e){t=e;return true};this.trackPrefix=function(e){r=e;return true};this.setDomainName=function(e){i=e;return true};this.useAnalytics=function(e){s=!!e;return true};this.useEnhancedLinkAttribution=function(e){f=!!e;return true};this.setPageEvent=function(e){o=e;return true};this.setCookieConfig=function(e){u=e;return true};this.useECommerce=function(e){a=!!e;return true};this.setRemoveRegExp=function(e){if(e instanceof RegExp){l=e;return true}return false};this.setExperimentId=function(e){c=e;return true};this.ignoreFirstPageLoad=function(e){h=!!e};this.$get=["$document","$rootScope","$location","$window",function(p,d,v,m){function y(){if(!n)return;m._gaq=[];m._gaq.push(["_setAccount",n]);if(i)m._gaq.push(["_setDomainName",i]);if(f){m._gaq.push(["_require","inpage_linkid","//www.google-analytics.com/plugins/ga/inpage_linkid.js"])}if(t&&!h){if(l){m._gaq.push(["_trackPageview",g()])}else{m._gaq.push(["_trackPageview"])}}(function(){var e=p[0];var t=e.createElement("script");t.type="text/javascript";t.async=true;t.src=("https:"===e.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var n=e.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)})();e=true}function b(){if(!n){return console.warn("No account id set for Analytics.js")}(function(e,t,n,r,i,s,o){e["GoogleAnalyticsObject"]=i;e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date;s=t.createElement(n),o=t.getElementsByTagName(n)[0];s.async=1;s.src=r;o.parentNode.insertBefore(s,o)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");m.ga("create",n,u);if(t&&!h){m.ga("send","pageview",g())}if(m.ga){if(a){m.ga("require","ecommerce","ecommerce.js")}if(f){m.ga("require","linkid","linkid.js")}if(c){var e=document.createElement("script"),r=document.getElementsByTagName("script")[0];e.src="//www.google-analytics.com/cx/api.js?experiment="+c;r.parentNode.insertBefore(e,r)}}}var g=function(){var e=v.path();if(l){return e.replace(l,"")}return e};this._log=function(){this._logs.push(arguments)};this._trackPage=function(e,n){n=n?n:p[0].title;if(t&&!s&&m._gaq){m._gaq.push(["_set","title",n]);m._gaq.push(["_trackPageview",r+e]);this._log("_trackPageview",arguments)}else if(t&&s&&m.ga){m.ga("send","pageview",{page:r+e,title:n});this._log("pageview",arguments)}};this._trackEvent=function(e,t,n,r){if(!s&&m._gaq){m._gaq.push(["_trackEvent",e,t,n,r]);this._log("trackEvent",arguments)}else if(m.ga){m.ga("send","event",e,t,n,r);this._log("event",arguments)}};this._addTrans=function(e,t,n,r,i,o,u,f,l){if(!s&&m._gaq){m._gaq.push(["_addTrans",e,t,n,r,i,o,u,f]);this._log("_addTrans",arguments)}else if(m.ga){if(!a){console.warn("ecommerce no set. Use AnalyticsProvider.setECommerce(true);")}else{m.ga("ecommerce:addTransaction",{id:e,affiliation:t,revenue:n,tax:r,shipping:i,currency:l||"USD"});this._log("ecommerce:addTransaction",arguments)}}};this._addItem=function(e,t,n,r,i,o){if(!s&&m._gaq){m._gaq.push(["_addItem",e,t,n,r,i,o]);this._log("_addItem",arguments)}else if(m.ga){m.ga("ecommerce:addItem",{id:e,name:n,sku:t,category:r,price:i,quantity:o});this._log("ecommerce:addItem",arguments)}};this._trackTrans=function(){if(!s&&m._gaq){m._gaq.push(["_trackTrans"]);this._log("_trackTrans",arguments)}else if(m.ga){m.ga("ecommerce:send");this._log("ecommerce:send",arguments)}};this._clearTrans=function(){if(m.ga){m.ga("ecommerce:clear");this._log("ecommerce:clear",arguments)}};this._send=function(e){if(m.ga){m.ga("send",e);this._log("send",e)}};if(s){b()}else{y()}var w=this;if(t)d.$on(o,function(){w._trackPage(g())});return{_logs:w._logs,cookieConfig:u,ecommerce:a,enhancedLinkAttribution:f,getUrl:g,experimentId:c,ignoreFirstPageLoad:h,trackPage:function(e,t){w._trackPage(e,t)},trackEvent:function(e,t,n,r){w._trackEvent(e,t,n,r)},addTrans:function(e,t,n,r,i,s,o,u,a){w._addTrans(e,t,n,r,i,s,o,u,a)},addItem:function(e,t,n,r,i,s){w._addItem(e,t,n,r,i,s)},trackTrans:function(){w._trackTrans()},clearTrans:function(){w._clearTrans()},send:function(e){w._send(e)}}}]})
