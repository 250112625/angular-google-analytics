/**
 * Angular Google Analytics - Easy tracking for your AngularJS application
 * @version v0.0.17 - 2015-07-23
 * @link http://github.com/revolunet/angular-google-analytics
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a,b,c,d){"use strict";c.module("angular-google-analytics",[]).provider("Analytics",function(){var d,e,f,g,h,i,j=!1,k=!0,l="",m=!1,n="$routeChangeSuccess",o="auto",p=!1,q=!1,r=!1,s=!1,t=!1,u={allowLinker:!0},v=!1,w=!1;this._logs=[],this.setAccount=function(a){return d=a,!0},this.trackPages=function(a){return k=a,!0},this.trackPrefix=function(a){return l=a,!0},this.setDomainName=function(a){return f=a,!0},this.useDisplayFeatures=function(a){return e=!!a,!0},this.useAnalytics=function(a){return m=!!a,!0},this.useEnhancedLinkAttribution=function(a){return r=!!a,!0},this.useCrossDomainLinker=function(a){return t=!!a,!0},this.setCrossLinkDomains=function(a){return i=a,!0},this.setPageEvent=function(a){return n=a,!0},this.setCookieConfig=function(a){return o=a,!0},this.useECommerce=function(a,b){return p=!!a,q=!!b,!0},this.setRemoveRegExp=function(a){return a instanceof RegExp?(g=a,!0):!1},this.setExperimentId=function(a){return h=a,!0},this.ignoreFirstPageLoad=function(a){return s=!!a,!0},this.trackUrlParams=function(a){return v=!!a,!0},this.delayScriptTag=function(a){return w=!!a,!0},this.$get=["$document","$location","$log","$rootScope","$window",function(x,y,z,A,B){function C(a){!m&&B._gaq&&"function"==typeof a&&a()}function D(a){m&&B.ga&&"function"==typeof a&&a()}function E(a,b){return!c.isUndefined(b)&&"name"in b&&b.name?b.name+"."+a:a}function F(a,b){return a in b&&b[a]}var G=this,H=function(){var a=v?y.url():y.path();return g?a.replace(g,""):a},I=function(){var a={utm_source:"campaignSource",utm_medium:"campaignMedium",utm_term:"campaignTerm",utm_content:"campaignContent",utm_campaign:"campaignName"},b={};return c.forEach(y.search(),function(d,e){var f=a[e];c.isDefined(f)&&(b[f]=d)}),b};return this._log=function(){arguments.length>0&&(arguments.length>1&&"warn"===arguments[0]&&z.warn(Array.prototype.slice.call(arguments,1)),this._logs.push(arguments))},this._createScriptTag=function(){if(!d)return void G._log("warn","No account id set to create script tag");if(j)return void G._log("warn","Script tag already created");B._gaq=[],B._gaq.push(["_setAccount",d]),f&&B._gaq.push(["_setDomainName",f]),r&&B._gaq.push(["_require","inpage_linkid","//www.google-analytics.com/plugins/ga/inpage_linkid.js"]),k&&!s&&(g?B._gaq.push(["_trackPageview",H()]):B._gaq.push(["_trackPageview"]));var a;return a=e?("https:"===b.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js":("https:"===b.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",function(){var b=x[0],c=b.createElement("script");c.type="text/javascript",c.async=!0,c.src=a;var d=b.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d)}(a),j=!0,!0},this._createAnalyticsScriptTag=function(){if(!d)return void G._log("warn","No account id set to create analytics script tag");if(j)return void G._log("warn","Analytics script tag already created");if(function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(a,b,"script","//www.google-analytics.com/analytics.js","ga"),c.isArray(d)?d.forEach(function(a){var b,d="cookieConfig"in a?a.cookieConfig:o;F("crossDomainLinker",a)&&(a.allowLinker=a.crossDomainLinker),c.forEach(["name","allowLinker"],function(d){d in a&&(c.isUndefined(b)&&(b={}),b[d]=a[d])}),c.isUndefined(b)?B.ga("create",a.tracker,d):B.ga("create",a.tracker,d,b),b&&"allowLinker"in b&&b.allowLinker&&(B.ga(E("require",a),"linker"),F("crossLinkDomains",a)&&B.ga(E("linker:autoLink",a),a.crossLinkDomains))}):t?(B.ga("create",d,o,u),B.ga("require","linker"),i&&B.ga("linker:autoLink",i)):B.ga("create",d,o),e&&B.ga("require","displayfeatures"),k&&!s&&B.ga("send","pageview",H()),B.ga&&(p&&(q?B.ga("require","ec","ec.js"):B.ga("require","ecommerce","ecommerce.js")),r&&B.ga("require","linkid","linkid.js"),h)){var f=b.createElement("script"),g=b.getElementsByTagName("script")[0];f.src="//www.google-analytics.com/cx/api.js?experiment="+h,g.parentNode.insertBefore(f,g)}return j=!0,!0},this._ecommerceEnabled=function(){return p&&!q},this._enhancedEcommerceEnabled=function(){return p&&q},this._trackPage=function(a,b,e){var f=this,g=arguments;a=a?a:H(),b=b?b:x[0].title,C(function(){B._gaq.push(["_set","title",b]),B._gaq.push(["_trackPageview",l+a]),f._log("_trackPageview",a,b,g)}),D(function(){var h={page:l+a,title:b};c.extend(h,I()),c.isObject(e)&&c.extend(h,e),c.isArray(d)?d.forEach(function(a){B.ga(E("send",a),"pageview",h)}):B.ga("send","pageview",h),f._log("pageview",a,b,g)})},this._trackEvent=function(a,b,e,f,g,h){var i=this,j=arguments;C(function(){B._gaq.push(["_trackEvent",a,b,e,f,!!g]),i._log("trackEvent",j)}),D(function(){var k={};c.isDefined(g)&&(k.nonInteraction=!!g),c.isObject(h)&&c.extend(k,h),c.isArray(d)?d.forEach(function(c){F("trackEvent",c)&&B.ga(E("send",c),"event",a,b,e,f,k)}):B.ga("send","event",a,b,e,f,k),i._log("event",j)})},this._addTrans=function(a,b,c,d,e,f,g,h,i){var j=this,k=arguments;C(function(){B._gaq.push(["_addTrans",a,b,c,d,e,f,g,h]),j._log("_addTrans",k)}),D(function(){j._ecommerceEnabled()&&(B.ga("ecommerce:addTransaction",{id:a,affiliation:b,revenue:c,tax:d,shipping:e,currency:i||"USD"}),j._log("ecommerce:addTransaction",k))})},this._addItem=function(a,b,c,d,e,f){var g=this,h=arguments;C(function(){B._gaq.push(["_addItem",a,b,c,d,e,f]),g._log("_addItem",h)}),D(function(){g._ecommerceEnabled()&&(B.ga("ecommerce:addItem",{id:a,name:c,sku:b,category:d,price:e,quantity:f}),g._log("ecommerce:addItem",h))})},this._trackTrans=function(){var a=this,b=arguments;C(function(){B._gaq.push(["_trackTrans"]),a._log("_trackTrans",b)}),D(function(){a._ecommerceEnabled()&&(B.ga("ecommerce:send"),a._log("ecommerce:send",b))})},this._clearTrans=function(){var a=this,b=arguments;D(function(){a._ecommerceEnabled()&&(B.ga("ecommerce:clear"),a._log("ecommerce:clear",b))})},this._addProduct=function(a,b,c,d,e,f,g,h,i){var j=this,k=arguments;C(function(){B._gaq.push(["_addProduct",a,b,c,d,e,f,g,h,i]),j._log("_addProduct",k)}),D(function(){j._enhancedEcommerceEnabled()&&(B.ga("ec:addProduct",{id:a,name:b,category:c,brand:d,variant:e,price:f,quantity:g,coupon:h,position:i}),j._log("ec:addProduct",k))})},this._addImpression=function(a,b,c,d,e,f,g,h){var i=this,j=arguments;C(function(){B._gaq.push(["_addImpression",a,b,c,d,e,f,g,h]),i._log("_addImpression",j)}),D(function(){i._enhancedEcommerceEnabled()&&(B.ga("ec:addImpression",{id:a,name:b,category:e,brand:d,variant:f,list:c,position:g,price:h}),i._log("ec:addImpression",j))})},this._addPromo=function(a,b,c,d){var e=this,f=arguments;C(function(){B._gaq.push(["_addPromo",a,b,c,d]),e._log("_addPromo",arguments)}),D(function(){e._enhancedEcommerceEnabled()&&(B.ga("ec:addPromo",{id:a,name:b,creative:c,position:d}),e._log("ec:addPromo",f))})},this._getActionFieldObject=function(a,b,c,d,e,f,g,h,i){var j={};return a&&(j.id=a),b&&(j.affiliation=b),c&&(j.revenue=c),d&&(j.tax=d),e&&(j.shipping=e),f&&(j.coupon=f),g&&(j.list=g),h&&(j.step=h),i&&(j.option=i),j},this._setAction=function(a,b){var c=this,d=arguments;C(function(){B._gaq.push(["_setAction",a,b]),c._log("__setAction",d)}),D(function(){c._enhancedEcommerceEnabled()&&(B.ga("ec:setAction",a,b),c._log("ec:setAction",d))})},this._trackTransaction=function(a,b,c,d,e,f,g,h,i){this._setAction("purchase",this._getActionFieldObject(a,b,c,d,e,f,g,h,i))},this._trackRefund=function(a){this._setAction("refund",this._getActionFieldObject(a))},this._trackCheckOut=function(a,b){this._setAction("checkout",this._getActionFieldObject(null,null,null,null,null,null,null,a,b))},this._trackCart=function(a){-1!==["add","remove"].indexOf(a)&&(this._setAction(a),this._send("event","UX","click",a+" to cart"))},this._promoClick=function(a){this._setAction("promo_click"),this._send("event","Internal Promotions","click",a)},this._productClick=function(a){this._setAction("click",this._getActionFieldObject(null,null,null,null,null,null,a,null,null)),this._send("event","UX","click",a)},this._send=function(){var a=this,b=Array.prototype.slice.call(arguments);b.unshift("send"),D(function(){B.ga.apply(this,b),a._log(b)})},this._pageView=function(){this._send("pageview")},this._set=function(a,b){var c=this;D(function(){B.ga("set",a,b),c._log("set",a,b)})},w||(m?this._createAnalyticsScriptTag():this._createScriptTag()),k&&A.$on(n,function(){G._trackPage()}),this._trackTimings=function(a,b,c,d){this._send("timing",a,b,c,d)},{_logs:G._logs,displayFeatures:e,ecommerce:p,enhancedEcommerce:q,enhancedLinkAttribution:r,getUrl:H,experimentId:h,ignoreFirstPageLoad:s,delayScriptTag:w,setCookieConfig:G._setCookieConfig,getCookieConfig:function(){return o},createAnalyticsScriptTag:function(a){return a&&(o=a),G._createAnalyticsScriptTag()},createScriptTag:function(a){return a&&(o=a),G._createScriptTag()},ecommerceEnabled:function(){return G._ecommerceEnabled()},enhancedEcommerceEnabled:function(){return G._enhancedEcommerceEnabled()},trackPage:function(a,b,c){G._trackPage(a,b,c)},trackEvent:function(a,b,c,d,e,f){G._trackEvent(a,b,c,d,e,f)},addTrans:function(a,b,c,d,e,f,g,h,i){G._addTrans(a,b,c,d,e,f,g,h,i)},addItem:function(a,b,c,d,e,f){G._addItem(a,b,c,d,e,f)},trackTrans:function(){G._trackTrans()},clearTrans:function(){G._clearTrans()},addProduct:function(a,b,c,d,e,f,g,h,i){G._addProduct(a,b,c,d,e,f,g,h,i)},addPromo:function(a,b,c,d){G._addPromo(a,b,c,d)},addImpression:function(a,b,c,d,e,f,g,h){G._addImpression(a,b,c,d,e,f,g,h)},productClick:function(a){G._productClick(a)},promoClick:function(a){G._promoClick(a)},trackDetail:function(){G._setAction("detail"),G._pageView()},trackCart:function(a){G._trackCart(a)},trackCheckout:function(a,b){G._trackCheckOut(a,b)},trackTimings:function(a,b,c,d){G._trackTimings(a,b,c,d)},trackTransaction:function(a,b,c,d,e,f,g,h,i){G._trackTransaction(a,b,c,d,e,f,g,h,i)},setAction:function(a,b){G._setAction(a,b)},send:function(a){G._send(a)},pageView:function(){G._pageView()},set:function(a,b){G._set(a,b)}}}]}).directive("gaTrackEvent",["Analytics","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f=b(e.gaTrackEvent);d.bind("click",function(){(!e.gaTrackEventIf||c.$eval(e.gaTrackEventIf))&&f.length>1&&a.trackEvent.apply(a,f(c))})}}}])}(window,document,window.angular);